<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>NetScaler VIP Dashboard</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
    body {
        background: #eef2f7;
        font-family: "Segoe UI", sans-serif;
    }

    .header-box {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        padding: 25px;
        border-radius: 18px;
        color: white;
        margin-bottom: 25px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.20);
    }

    .table-container {
        background: white;
        padding: 25px;
        border-radius: 18px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.10);
        transition: 0.3s ease;
    }
    .table-container:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .badge-up {
        background: #28a745;
        font-size: 0.85rem;
    }

    .badge-down {
        background: #dc3545;
        font-size: 0.85rem;
    }

    .badge-unknown {
        background: #6c757d;
        font-size: 0.85rem;
    }

    .search-box {
        background: white;
        border-radius: 12px;
        padding: 18px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

</style>
</head>

<body class="p-4">

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4 rounded">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <i class="fa-solid fa-network-wired me-2"></i>NetScaler Portal
    </a>

    <div class="navbar-nav ms-auto">
      {% if current_user.is_authenticated %}
        <span class="navbar-text me-3">
          <i class="fa-solid fa-user me-1"></i>{{ current_user.username }}
        </span>
        <a class="btn btn-outline-light btn-sm" href="{{ url_for('logout') }}">
          <i class="fa-solid fa-sign-out-alt me-1"></i>Logout
        </a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container">

    <!-- HEADER / WELCOME -->
    <div class="header-box">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fa-solid fa-network-wired"></i> NetScaler Configuration Portal</h1>
                <p class="m-0">Welcome! Below is your live VIP Inventory from NetScaler.</p>
            </div>
            <div class="device-selector">
                <form method="GET" class="d-flex align-items-center">
                    <label class="me-2 text-white"><i class="fa-solid fa-server"></i> Device:</label>
                    <select name="device_id" class="form-select form-select-sm" onchange="this.form.submit()">
                        {% for device_id, device in devices.items() %}
                        <option value="{{ device_id }}" {% if device_id == selected_device %}selected{% endif %}>
                            {{ device.name }}
                        </option>
                        {% endfor %}
                    </select>
                </form>
            </div>
        </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="m-0 text-primary"><i class="fa-solid fa-table"></i> VIP Inventory</h3>

        <a href="/create?device_id={{ selected_device }}" class="btn btn-success">
            <i class="fa-solid fa-plus-circle"></i> Create VIP
        </a>
    </div>

    <!-- SEARCH / FILTER BAR -->
    <div class="search-box mb-3">
        <div class="row">
            <div class="col-md-4 mb-2">
                <input id="searchName" type="text" class="form-control" placeholder="Search by VIP Name...">
            </div>

            <div class="col-md-4 mb-2">
                <input id="searchIP" type="text" class="form-control" placeholder="Search by IP Address...">
            </div>

            <div class="col-md-4 mb-2">
                <select id="filterType" class="form-select">
                    <option value="">Filter by Service Type (All)</option>
                    <option>HTTP</option>
                    <option>SSL</option>
                    <option>TCP</option>
                </select>
            </div>
        </div>
    </div>

    <!-- TABLE -->
    <div class="table-container">
        <table id="vipTable" class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>VIP Name</th>
                    <th>IP</th>
                    <th>Port</th>
                    <th>Service Type</th>
                    <th>State</th>
                </tr>
            </thead>

            <tbody>
                {% for v in lbvs %}
                <tr>
                    <td>{{ v.name }}</td>
                    <td>{{ v.ipv46 }}</td>
                    <td>{{ v.port }}</td>
                    <td>{{ v.servicetype }}</td>
                    <td>
                        {% if v.vsvrstate == "UP" %}
                            <span class="badge badge-up">UP</span>
                        {% elif v.vsvrstate == "DOWN" %}
                            <span class="badge badge-down">DOWN</span>
                        {% else %}
                            <span class="badge badge-unknown">UNKNOWN</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
// Simple Search Filter
document.addEventListener("input", function () {
    let name = document.getElementById("searchName").value.toLowerCase();
    let ip = document.getElementById("searchIP").value.toLowerCase();
    let type = document.getElementById("filterType").value.toLowerCase();

    let rows = document.querySelectorAll("#vipTable tbody tr");

    rows.forEach(row => {
        let vipName = row.cells[0].innerText.toLowerCase();
        let vipIP = row.cells[1].innerText.toLowerCase();
        let svcType = row.cells[3].innerText.toLowerCase();

        row.style.display =
            (vipName.includes(name)) &&
            (vipIP.includes(ip)) &&
            (svcType.includes(type)) ?
            "" : "none";
    });
});
</script>

</body>
</html>
